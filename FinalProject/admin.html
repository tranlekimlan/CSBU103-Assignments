<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Qu·∫£n Tr·ªã (Admin)</title>
    <link rel="stylesheet" href="style.css"> 
    <style>
        /*1. To√†n b·ªô trang */
        body { 
            padding: 20px; 
            font-family: Arial, sans-serif; 
            /* M√†u n·ªÅn t√≠m ƒë·∫≠m c·ªßa game */
            background-color: #2a0944; 
            color: #fff; 
        }

        h1, h2 {
            text-align: center;
            /* M√†u v√†ng kim ƒë·∫∑c tr∆∞ng */
            color: #ffcc00; 
            text-shadow: 0 0 8px rgba(255, 204, 0, 0.5);
        }

        .container { 
            display: flex; 
            gap: 20px; 
            margin-top: 20px;
        }
        
        /* 2. C√°c kh·ªëi (Container) gi·ªëng th·∫ª b√†i (Char-card) */
        .form-section, .list-section { 
            flex: 1; 
            /* M√†u n·ªÅn t√≠m v·ª´a */
            background-color: #3b0a45; 
            padding: 20px; 
            border-radius: 15px; 
            /* Vi·ªÅn t√≠m nh·∫°t neon */
            border: 1px solid #b388ff; 
            box-shadow: 0 0 15px rgba(179, 136, 255, 0.2);
        }

        /* 3. Ph·∫ßn danh s√°ch (List) c√≥ thanh cu·ªôn */
        .list-section { 
            height: 80vh; 
            overflow-y: auto; 
        }

        /* T√πy ch·ªânh thanh cu·ªôn cho ƒë·∫πp (Webkit) */
        .list-section::-webkit-scrollbar {
            width: 8px;
        }
        .list-section::-webkit-scrollbar-track {
            background: #1a0033; 
            border-radius: 4px;
        }
        .list-section::-webkit-scrollbar-thumb {
            background: #b388ff; 
            border-radius: 4px;
        }

        /* 4. √î nh·∫≠p li·ªáu (Input) */
        input { 
            display: block; 
            margin: 10px 0 20px 0; 
            padding: 12px; 
            width: 90%; 
            /* N·ªÅn t·ªëi th·∫´m */
            background-color: #1a0033; 
            /* Ch·ªØ tr·∫Øng */
            color: #fff; 
            border: 1px solid #6a0dad; 
            border-radius: 5px;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: #00ffff; /* Highlight m√†u cyan khi b·∫•m v√†o */
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }

        label { 
            font-weight: bold; 
            margin-top: 15px; 
            display: block; 
            color: #b388ff; /* M√†u t√≠m nh·∫°t cho nh√£n */
        }

        /* 5. Item trong danh s√°ch */
        .item { 
            display: flex; 
            align-items: center; 
            padding: 12px; 
            border-bottom: 1px solid #6a0dad; 
            cursor: pointer; 
            transition: 0.2s; 
            border-radius: 8px;
        }
        .item:hover { 
            /* Hi·ªáu ·ª©ng hover s√°ng l√™n */
            background-color: #6a0dad; 
            transform: translateX(5px);
        }
        .item img { 
            width: 50px; 
            height: 50px; 
            object-fit: contain; /* ƒê·ªïi cover th√†nh contain ƒë·ªÉ kh√¥ng c·∫Øt ·∫£nh pixel */
            background: #000;
            border-radius: 5px; 
            border: 1px solid #fff;
            margin-right: 15px; 
        }
        .item strong {
            color: #ffcc00;
            font-size: 1.1em;
        }
        .item small {
            color: #ccc;
        }
        
        /* 6. N√∫t b·∫•m (Buttons) */
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn-add { 
            background: linear-gradient(45deg, #00b09b, #96c93d); /* M√†u xanh l√° ma thu·∫≠t */
            color: white; 
            box-shadow: 0 4px 10px rgba(0, 255, 0, 0.3);
        }
        .btn-add:hover { transform: scale(1.05); box-shadow: 0 0 15px #96c93d; }

        .btn-update { 
            background: linear-gradient(45deg, #ff9966, #ff5e62); /* M√†u cam ch√°y */
            color: white; 
            display: none; 
            box-shadow: 0 4px 10px rgba(255, 94, 98, 0.3);
        }
        .btn-update:hover { transform: scale(1.05); box-shadow: 0 0 15px #ff5e62; }

        .btn-cancel { 
            background: #444; 
            color: #aaa; 
            display: none; 
            margin-left: 10px;
        }
        .btn-cancel:hover { background: #666; color: white; }
        
        
        /* Responsive cho Mobile */
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .list-section { height: 400px; }
        }
    </style>
</head>
<body>

    <h1>Admin Panel</h1>

    <div class="container">
        <div class="form-section">
            <h2 id="form-title">Th√™m Nh√¢n V·∫≠t M·ªõi</h2>
            <input type="hidden" id="charId"> 
            
            <label>T√™n nh√¢n v·∫≠t:</label>
            <input type="text" id="charName" placeholder="V√≠ d·ª•: K·ªã sƒ©">

            <label>Link ·∫£nh (URL):</label>
            <input type="text" id="charImage" placeholder="V√≠ d·ª•: images/knight.gif">

            <div class="link-input-group">
                <label style="color: #b388ff;">File HTML Chi ti·∫øt (Trang ƒë√≠ch):</label>
                <input type="text" id="charPageUrl" placeholder="V√≠ d·ª•: knight.html">
                <small style="color: #666; font-style: italic;">Nh·∫≠p t√™n file HTML b·∫°n ƒë√£ t·∫°o. N·∫øu ƒë·ªÉ tr·ªëng s·∫Ω v·ªÅ trang ch·ªß (#).</small>
            </div>
            <label>M√°u (HP):</label>
            <input type="number" id="charHp">

            <label>Gi√°p (Armor):</label>
            <input type="number" id="charArmor">

            <label>NƒÉng l∆∞·ª£ng (Energy):</label>
            <input type="number" id="charEnergy">

            <div style="margin-top: 20px;">
                <button class="btn-add" onclick="createChar()" id="btnAdd">TH√äM M·ªöI</button>
                <button class="btn-update" onclick="updateChar()" id="btnUpdate">L∆ØU C·∫¨P NH·∫¨T</button>
                <button class="btn-cancel" onclick="resetForm()" id="btnCancel">H·ª¶Y S·ª¨A</button>
            </div>
            <p id="status-msg"></p>
        </div>

        <div class="list-section">
            <h2>Danh S√°ch Hi·ªán C√≥</h2>
            <p><i>(B·∫•m v√†o nh√¢n v·∫≠t ƒë·ªÉ s·ª≠a)</i></p>
            <div id="char-list">
                </div>
        </div>
    </div>

    <script>
        // Khi trang web t·∫£i xong, l·∫•y danh s√°ch ngay
        window.onload = loadCharacters;

        // 1. H√ÄM T·∫¢I DANH S√ÅCH
        async function loadCharacters() {
            try {
                const res = await fetch('/api/characters');
                const chars = await res.json();
                
                const listDiv = document.getElementById('char-list');
                listDiv.innerHTML = ''; // X√≥a danh s√°ch c≈©

                chars.forEach(char => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <img src="${char.image}" onerror="this.src='https://via.placeholder.com/50'">
                        <div>
                            <strong>${char.name}</strong><br>
                            <small>Link: ${char.pageUrl || '(Ch∆∞a c√≥ ho·∫∑c l·ªói)'}</small>
                        </div>
                    `;
                    div.onclick = () => selectCharToEdit(char);
                    listDiv.appendChild(div);
                });
            } catch (err) {
                console.error(err);
                alert("L·ªói t·∫£i danh s√°ch!");
            }
        }

        // 2. H√ÄM CH·ªåN NH√ÇN V·∫¨T ƒê·ªÇ S·ª¨A
        function selectCharToEdit(char) {
            document.getElementById('form-title').innerText = "ƒêang S·ª≠a: " + char.name;
            document.getElementById('btnAdd').style.display = 'none';
            document.getElementById('btnUpdate').style.display = 'inline-block';
            document.getElementById('btnCancel').style.display = 'inline-block';

            // ƒêi·ªÅn th√¥ng tin c≈© v√†o √¥
            document.getElementById('charId').value = char._id; 
            document.getElementById('charName').value = char.name;
            document.getElementById('charHp').value = char.hp;
            document.getElementById('charArmor').value = char.armor;
            document.getElementById('charEnergy').value = char.energy;
            document.getElementById('charImage').value = char.image;
            
            // üëá ƒêI·ªÄN LINK HTML C≈® V√ÄO √î (N·∫øu c√≥)
            document.getElementById('charPageUrl').value = char.pageUrl || ''; 
        }

        // 3. H√ÄM TH√äM M·ªöI
        async function createChar() {
            const payload = getFormData();
            await fetch('/api/characters', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            alert("ƒê√£ th√™m th√†nh c√¥ng!");
            resetForm();
            loadCharacters();
        }

        // 4. H√ÄM C·∫¨P NH·∫¨T
        async function updateChar() {
            const id = document.getElementById('charId').value;
            const payload = getFormData();

            await fetch('/api/characters/' + id, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            alert("ƒê√£ c·∫≠p nh·∫≠t xong!");
            resetForm();
            loadCharacters();
        }

        // Ph·ª• tr·ª£: L·∫•y d·ªØ li·ªáu t·ª´ Form
        function getFormData() {
            return {
                name: document.getElementById('charName').value,
                hp: document.getElementById('charHp').value,
                armor: document.getElementById('charArmor').value,
                energy: document.getElementById('charEnergy').value,
                image: document.getElementById('charImage').value,
                
                // üëá L·∫§Y GI√Å TR·ªä T·ª™ √î LINK HTML M·ªöI
                // N·∫øu ng∆∞·ªùi d√πng kh√¥ng nh·∫≠p th√¨ m·∫∑c ƒë·ªãnh l√† '#'
                pageUrl: document.getElementById('charPageUrl').value || '#'
            };
        }

        // Ph·ª• tr·ª£: H·ªßy ch·∫ø ƒë·ªô s·ª≠a
        function resetForm() {
            document.getElementById('form-title').innerText = "Th√™m Nh√¢n V·∫≠t M·ªõi";
            document.getElementById('btnAdd').style.display = 'inline-block';
            document.getElementById('btnUpdate').style.display = 'none';
            document.getElementById('btnCancel').style.display = 'none';
            
            document.getElementById('charId').value = "";
            document.getElementById('charName').value = "";
            document.getElementById('charHp').value = "";
            document.getElementById('charArmor').value = "";
            document.getElementById('charEnergy').value = "";
            document.getElementById('charImage').value = "";
            
            // üëá RESET √î LINK HTML
            document.getElementById('charPageUrl').value = "";
        }
    </script>
</body>
</html>